---
description: 
globs: 
alwaysApply: true
---
# Modul: Content Planner mit Facebook-Integration

## Zweck
Der Content Planner dient zur kanalübergreifenden Planung, Verwaltung und ggf. automatisierten Veröffentlichung von Inhalten für Social-Media-Kampagnen. Mit der Integration der Facebook-API wird es möglich, Beiträge direkt über das System zu planen und über die Meta Business API zu veröffentlichen.

---

## Datenbankstruktur

### Tabelle: `public.content_posts`
| Spalte        | Typ        | Beschreibung                                     |
|---------------|------------|--------------------------------------------------|
| id            | UUID       | Primärschlüssel                                 |
| campaign_id   | UUID       | FK → campaigns.id                              |
| title         | TEXT       | Beitragstitel                                    |
| content       | TEXT       | Textinhalt / Copy                                |
| media_url     | TEXT       | Link zu Bild/Video (aus MediaLibrary)            |
| channel       | TEXT       | z. B. "Facebook", "Instagram"                    |
| post_date     | TIMESTAMP  | Geplantes Veröffentlichungsdatum                |
| status        | TEXT       | `draft`, `scheduled`, `published`, `error`       |
| facebook_post_id | TEXT    | ID des veröffentlichten Facebook-Posts (optional) |
| created_at    | TIMESTAMP  | Erstellt am                                      |
| updated_at    | TIMESTAMP  | Zuletzt aktualisiert                             |

---

## API-Integration: Facebook / Meta
- Nutzung der **Meta Graph API** zur automatisierten Veröffentlichung
- Authentifizierung über Zugriffstoken (Seiten-Token)
- Voraussetzungen:
  - Verknüpfung der Meta-Seite in den Einstellungen
  - Upload der Bilder vorab über MediaLibrary oder direkten Link
- Beim Veröffentlichen wird `facebook_post_id` gespeichert
- Status ändert sich zu `published` oder `error`

---

## User Flow

1. **Planung:**
   - Nutzer wählt Kampagne und Kanal (z. B. Facebook)
   - Trägt Beitragsinhalt, Bild/Video und Datum ein
   - Speichert als "geplant"

2. **Veröffentlichung:**
   - Bei geplanten Beiträgen mit Facebook als Kanal läuft ein Server-Prozess, der über die Facebook-API postet
   - Rückmeldung zum Status (published / error)

3. **Bearbeitung:**
   - Geplante Posts sind editierbar
   - Veröffentlichte Posts nur noch sichtbar, aber nicht mehr änderbar

4. **Kalenderansicht / Beitragsliste:**
   - Darstellung als Wochen-/Monatsplan
   - Filterbar nach Kampagne, Kanal, Status

---

## UI-Komponenten
- `ContentPlannerCalendar`: Zeitbasierte Beitragsübersicht
- `ContentPostModal`: Formular zur Beitragsplanung
- `ChannelBadge`: Farbige Darstellung des Kanals (Facebook etc.)
- `PostStatusTag`: Statusanzeige (z. B. Scheduled, Published)

---

## Rollenrechte
| Rolle        | Berechtigung                                          |
|--------------|--------------------------------------------------------|
| Admin        | Beiträge für alle Kampagnen planen und veröffentlichen |
| Studioleiter | Beiträge innerhalb der eigenen Kampagnen planen       |
| Mitarbeiter  | Vorschläge einreichen (Status: `draft`)              |

---

## Hinweise zur Architektur
- **Verknüpft mit:**
  - `campaigns.id`
  - `storage.objects` für Bilder / Videos
- **Ergänzend benötigt:**
  - Tabelle `public.social_accounts` für API-Tokens je Seite

---

## SQL-Erweiterungsvorschlag
```sql
CREATE TABLE IF NOT EXISTS public.content_posts (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    campaign_id UUID REFERENCES public.campaigns(id) ON DELETE CASCADE,
    title TEXT NOT NULL,
    content TEXT NOT NULL,
    media_url TEXT,
    channel TEXT NOT NULL,
    post_date TIMESTAMP NOT NULL,
    status TEXT NOT NULL DEFAULT 'draft',
    facebook_post_id TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT now(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT now()
);
```

---

## Erweiterungsidee
- Später erweiterbar um weitere Kanäle: LinkedIn, TikTok etc.
- Automatisches Tagging / Tracking mit UTM-Parametern für Kampagnenmessung
