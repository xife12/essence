---
description: 
globs: 
alwaysApply: true
---
# Modul: Media Library & Vorlagenverwaltung

## Zweck
Die Media Library dient als zentrale Verwaltung von Mediendateien (Bilder, Videos, PDFs) und wiederverwendbaren Vorlagen (z. B. Checklisten, Abläufe, Textbausteine). Sie kann sowohl innerhalb von Kampagnen als auch global genutzt werden.

---

## Datenbankstruktur

### Tabelle: `public.media_assets`
| Spalte        | Typ        | Beschreibung                                |
|---------------|------------|---------------------------------------------|
| id            | UUID       | Primärschlüssel                             |
| name          | TEXT       | Dateiname oder Titel                        |
| type          | TEXT       | `image`, `video`, `pdf`, `template`         |
| category      | TEXT       | z. B. „Landingpage“, „Vorlage“, „Kampagne“  |
| url           | TEXT       | Pfad zur Datei im Supabase Storage          |
| tags          | TEXT[]     | z. B. ["Fitness", "Instagram"]              |
| created_by    | UUID       | FK → `staff.id`                             |
| created_at    | TIMESTAMP  | Zeitstempel                                 |
| updated_at    | TIMESTAMP  | Zeitstempel                                 |


### Tabelle: `public.templates`
| Spalte         | Typ        | Beschreibung                                |
|----------------|------------|---------------------------------------------|
| id             | UUID       | Primärschlüssel                             |
| name           | TEXT       | Vorlagenname                                |
| type           | TEXT       | `testimonial`, `form`, `process`, `layout`  |
| content        | JSONB      | Inhalt als JSON-Struktur                    |
| description    | TEXT       | Freitext zur Erklärung                      |
| is_global      | BOOLEAN    | Globale Vorlage oder kampagnenspezifisch?   |
| created_by     | UUID       | FK → staff                                  |
| created_at     | TIMESTAMP  | Erstellt am                                 |
| updated_at     | TIMESTAMP  | Geändert am                                 |

---

## User Flow & UI-Komponenten

1. **Media Dashboard (`/media`):**
   - Tabs: Dateien | Vorlagen
   - Such- & Filterfunktionen nach Typ, Tag, Kategorie
   - Upload-Button mit Drag-and-Drop

2. **Vorlageneditor:**
   - Formular zur Erstellung von Formularen, Testimonials, Prozessen
   - Visual Editor mit Vorschau
   - Templates können mit Tags versehen und versioniert werden

3. **Verwendung in Kampagnen / Landingpages:**
   - Auswahl bestehender Vorlagen (Dropdown)
   - Möglichkeit zur Duplikation + Anpassung → wird als neue Instanz gespeichert

4. **Gamification-Erweiterung (optional):**
   - Interaktive Elemente wie Fortschrittsbalken, Quests, Umfragen als Vorlagen hinterlegbar

---

## API-Nutzung / Speicherung
- Dateien werden im Supabase Storage gespeichert (`storage.objects`)
- Templates und Metainformationen in `media_assets` & `templates`

---

## Rollen & Berechtigungen
| Rolle        | Berechtigung                         |
|--------------|---------------------------------------|
| Admin        | Alle Aktionen                         |
| Studioleiter | Upload, Bearbeiten, eigene Vorlagen   |
| Mitarbeiter  | Nur Einsehen & Auswählen              |

---

## Hinweise für Cursor (Entwicklung)
- Einheitliche UI für Drag-and-Drop Upload
- Auswahlkomponenten für Templates in Kampagneneditor, Landingpages, Formularmodul
- Vorschaubilder automatisch generieren (z. B. bei PDFs oder Layouts)
- Felder und Typen validieren bei Uploads (nur erlaubte Formate je Typ)

---

## SQL-Anpassung
```sql
CREATE TABLE IF NOT EXISTS public.media_assets (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name TEXT NOT NULL,
    type TEXT NOT NULL CHECK (type IN ('image', 'video', 'pdf', 'template')),
    category TEXT,
    url TEXT NOT NULL,
    tags TEXT[],
    created_by UUID REFERENCES public.staff(id),
    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ DEFAULT now()
);

CREATE TABLE IF NOT EXISTS public.templates (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name TEXT NOT NULL,
    type TEXT NOT NULL CHECK (type IN ('testimonial', 'form', 'process', 'layout')),
    content JSONB NOT NULL,
    description TEXT,
    is_global BOOLEAN DEFAULT false,
    created_by UUID REFERENCES public.staff(id),
    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ DEFAULT now()
);
```

---

## Verknüpfungen zu anderen Modulen
- Kampagneneditor: Auswahl von Bildmaterial, Formular- und Testimonial-Vorlagen
- Landingpages: Direkte Integration von Templates aus der Media Library
- Content Planner: Nutzung von Bildern/Videos in Postings & Ads
