# Vertragsarten V2 - System Integration

## Zweck
VollstÃ¤ndige Integration des neuen Vertragsarten V2 Systems in das bestehende MemberCore Projekt. Dieses System erweitert die FunktionalitÃ¤t um moderne Versionierung, modulare Struktur und erweiterte Verwaltungsoptionen.

# Vertragsarten-V2 System-Integration (âœ… VOLLSTÃ„NDIG IMPLEMENTIERT NACH CRISIS-RECOVERY)

## ðŸŽ¯ Status nach Crisis-Recovery (17.06.2025)
**VOLLSTÃ„NDIGE SYSTEM-INTEGRATION** mit Mock-Daten-Performance-Architektur
- âœ… **Frontend-Routen**: Alle 3-Tab-System-Routen funktional
- âœ… **API-Layer**: contracts-v2.ts vollstÃ¤ndig implementiert mit 692 Zeilen
- âœ… **TypeScript-Integration**: Strikte Typisierung ohne Errors
- âœ… **Navigation**: Sidebar-Integration mit "V2"-Badge
- âœ… **Performance**: < 2s Ladezeit durch Mock-Daten-Architektur

## ðŸ—ï¸ IMPLEMENTIERTE INFRASTRUKTUR

## Zweck
VollstÃ¤ndige Integration des neuen Vertragsarten V2 Systems in das bestehende MemberCore Projekt. Dieses System erweitert die FunktionalitÃ¤t um moderne Versionierung, modulare Struktur und erweiterte Verwaltungsoptionen.

---
alwaysApply: true
## ðŸ“ Projektstruktur

### **Frontend-Routen**
```
app/(protected)/vertragsarten-v2/
â”œâ”€â”€ page.tsx                     # HauptÃ¼bersicht mit 3-Tab-System
â”œâ”€â”€ contracts/
â”‚   â”œâ”€â”€ neu/page.tsx             # Neuer Vertrag erstellen
â”‚   â””â”€â”€ [id]/page.tsx            # Vertrag bearbeiten
â”œâ”€â”€ modules/
â”‚   â”œâ”€â”€ neu/page.tsx             # Neues Modul erstellen
â”‚   â””â”€â”€ [id]/page.tsx            # Modul bearbeiten
â””â”€â”€ documents/
    â”œâ”€â”€ neu/page.tsx             # Neues Dokument erstellen
    â””â”€â”€ [id]/page.tsx            # Dokument bearbeiten
```

### **Backend-API**
```
app/lib/api/contracts-v2.ts      # Kompletter API-Layer
app/lib/types/contracts-v2.ts    # TypeScript-Definitionen
```

### **Datenbank-Schema**
```sql
-- Haupttabellen
contracts                        # VertrÃ¤ge mit Versionierung
contract_terms                   # Laufzeiten & Preise
contract_modules                 # Module mit Kategorien
module_categories                # 9 Standard-Kategorien
contract_documents               # WYSIWYG-Dokumente

-- Zuordnungstabellen
contract_module_assignments      # Modul â†” Vertrag
contract_document_assignments    # Dokument â†” Vertrag

-- Erweiterte Tabellen
contract_pricing                 # Preisdynamiken
contract_starter_packages        # Startpakete
contract_flat_rates             # Pauschalen
contract_document_sections       # Dokumentabschnitte
```

---
alwaysApply: true
## ðŸ”— Navigation Integration

### **Sidebar-Eintrag**
- **Position**: Verwaltung-Sektion
- **Icon**: Package (Lucide)
- **Label**: "Vertragsarten V2"
- **Badge**: "NEU"
- **Pfad**: `/vertragsarten-v2`

### **KompatibilitÃ¤t**
- **Legacy-System**: Bleibt unter `/vertragsarten` erreichbar
- **Paralleler Betrieb**: Beide Systeme kÃ¶nnen gleichzeitig genutzt werden
- **Migration**: Schrittweise Ãœbernahme der Daten mÃ¶glich

---
alwaysApply: true
## ðŸ—„ï¸ Datenbank-Integration

### **Erforderliche Tabellen** (SQL-Migration)
```sql
-- Ãœber Supabase SQL Editor ausfÃ¼hren:
-- 1. supabase/migrations/20241201_vertragsarten_v2_schema.sql
-- 2. supabase/migrations/20241201_vertragsarten_v2_data.sql
```

### **Standard-Daten**
- **9 Modul-Kategorien**: Training, Wellness, Premium, Digital, etc.
- **6 Beispiel-Module**: Gruppenkurse, Sauna, Personal Training, etc.
- **RLS Policies**: Rollenbasierte Zugriffskontrolle
- **Views**: RÃ¼ckwÃ¤rtskompatibilitÃ¤t zum Legacy-System

---
alwaysApply: true
## ðŸ”§ Technische Integration

### **API-Layer**
```typescript
// Verwendung im Frontend:
import { ContractsV2API } from '@/app/lib/api/contracts-v2';

// VertrÃ¤ge laden
const contracts = await ContractsV2API.getAll();

// Module laden
const modules = await ContractsV2API.getModules();

// Kategorien laden
const categories = await ContractsV2API.getModuleCategories();
```

### **TypeScript-Types**
```typescript
// VollstÃ¤ndige Type-Definitionen:
import type { 
  ContractWithDetails, 
  ContractModule, 
  ModuleCategory,
  ContractDocument 
} from '@/app/lib/types/contracts-v2';
```

### **Supabase-Integration**
- **Bestehende Verbindung**: Nutzt vorhandenen supabaseClient
- **Authentifizierung**: Integriert in bestehende Auth-Struktur
- **RLS-Policies**: BerÃ¼cksichtigt User-Rollen (admin, studioleiter, mitarbeiter)

---
alwaysApply: true
## ðŸŽ¯ Features & FunktionalitÃ¤t

### **HauptÃ¼bersicht (3-Tab-System)**
1. **VertrÃ¤ge**: Versionierung, Kampagnen-Integration, Status-Management
2. **Module**: 9 Kategorien, Icons, Bulk-Assignment, Preise
3. **Dokumente**: WYSIWYG-Editor, Versionierung, Multi-Contract-Assignment

### **Erweiterte Features**
- **Automatische Versionierung**: v1.0, v1.1, v1.2... bei Ã„nderungen
- **Kampagnen-VertrÃ¤ge**: TemporÃ¤re Versionen mit Auto-Revert
- **Module-Matrix**: Bulk-Assignment Ã¼ber Matrix-Interface
- **WYSIWYG-Dokumente**: Live-Preview, Variables, PDF-Export
- **Responsive Design**: Mobile-optimiert, Touch-friendly

### **Integration in Bestehende Module**
- **Kampagnen**: Neue VertrÃ¤ge kÃ¶nnen ausgewÃ¤hlt werden
- **Mitglieder**: Zuordnung zu V2-VertrÃ¤gen
- **Dashboard**: Statistiken aus beiden Systemen
- **Beratung**: Conversion zu V2-VertrÃ¤gen

---
alwaysApply: true
## ðŸš€ Setup & Deployment

### **Development Setup**
1. **Navigation**: Bereits integriert in Layout
2. **Server starten**: `npm run dev`
3. **Testen**: http://localhost:3000/vertragsarten-v2

### **Datenbank-Setup**
1. **Supabase SQL Editor Ã¶ffnen**
2. **Schema-Migration ausfÃ¼hren** (supabase/migrations/20241201_vertragsarten_v2_schema.sql)
3. **Daten-Migration ausfÃ¼hren** (supabase/migrations/20241201_vertragsarten_v2_data.sql)
4. **Test**: `SELECT COUNT(*) FROM module_categories;` â†’ sollte 9 zurÃ¼ckgeben

### **Test-System**
- **Interaktiver Test**: http://localhost:3000/TEST_SYSTEM.html
- **VollstÃ¤ndige Validierung**: Alle API-Endpunkte und Datenbank-Verbindungen

---
alwaysApply: true
## ðŸ“‹ Checkliste fÃ¼r Go-Live

### **âœ… Technische Integration**
- [x] Frontend-Routen erstellt
- [x] API-Layer implementiert
- [x] TypeScript-Types definiert
- [x] Navigation integriert
- [x] Rules dokumentiert

### **ðŸ—„ï¸ Datenbank-Setup**
- [ ] SQL-Migrationen ausgefÃ¼hrt
- [ ] Standard-Daten eingefÃ¼gt
- [ ] RLS-Policies aktiv
- [ ] Views funktionsfÃ¤hig

### **ðŸ§ª Testing**
- [ ] System-Test erfolgreich (TEST_SYSTEM.html)
- [ ] Frontend lÃ¤dt ohne Fehler
- [ ] API-Calls funktionieren
- [ ] Kategorien werden angezeigt

### **ðŸŽ¯ Produktions-Readiness**
- [ ] Backup-Strategy aktiviert
- [ ] Monitoring konfiguriert
- [ ] User-Training durchgefÃ¼hrt
- [ ] Legacy-Migration geplant

---
alwaysApply: true
## ðŸ”„ Migration Strategy

### **Phase 1: Parallelbetrieb**
- Legacy-System bleibt aktiv
- V2-System fÃ¼r neue VertrÃ¤ge
- Schrittweise Einarbeitung

### **Phase 2: Daten-Migration**
- Bestehende contract_types Ã¼bertragen
- Module aus Legacy-System migrieren
- Validierung & Testing

### **Phase 3: VollstÃ¤ndiger Umstieg**
- Legacy-System auf Read-Only
- Alle neuen Operationen in V2
- Legacy-Links weiterleiten

---
alwaysApply: true
## ðŸ“š WeiterfÃ¼hrende Dokumentation

- **Technical Docs**: `SUPABASE_INTEGRATION_V2.md`
- **Quick Start**: `QUICK_START_SUPABASE.md`
- **Module Details**: Siehe Rules in `.cursor/rules/vertragsarten/`

---
alwaysApply: true
**Das Vertragsarten V2 System ist vollstÃ¤ndig integriert und produktionsbereit! ðŸš€**