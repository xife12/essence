---
description:
globs:
alwaysApply: false
---
## Modul: Landingpages

### Zweck
Dieses Modul verwaltet alle Landingpages, die fÃ¼r Kampagnenaktionen erstellt werden. Jede Landingpage kann mit einem visuellen Builder aufgebaut werden, unterstÃ¼tzt Tracking, Formularerfassung und Integration in das Kampagnenmodul.

---

## ğŸ—ï¸ **Modulstruktur (Hierarchische Navigation)**

```
ğŸ“„ Landingpages/
â”œâ”€â”€ ğŸ“‹ Ãœbersicht (Alle Landingpages)
â”œâ”€â”€ ğŸ—ï¸ Builder ([id]/builder - Page Builder)
â”œâ”€â”€ ğŸ’¬ Testimonials (Testimonial-Verwaltung)
â”œâ”€â”€ ğŸ“ Formulare (Formular-Templates)
â”œâ”€â”€ ğŸ¨ Vorlagen (Page-Templates)
â”œâ”€â”€ ğŸ­ CI-Design (Brand Guidelines)
â””â”€â”€ âš™ï¸ Einstellungen (Rechtliches & Tracking)
```

---

## ğŸ“Š **Datenbank-EntitÃ¤ten**

### **1. landingpage (Haupttabelle)**

| Feld              | Typ       | Beschreibung |
|----|-----|-----|
| id                | UUID      | PrimÃ¤rschlÃ¼ssel |
| title             | TEXT      | Interner Name |
| slug              | TEXT      | URL-Pfad (z. B. "rueckenfit") |
| headline          | TEXT      | HauptÃ¼berschrift |
| subheadline       | TEXT      | Unterzeile |
| description       | TEXT      | SEO-Beschreibung |
| design_template   | TEXT      | Template-Name (fitness-modern, corporate-clean, wellness-warm) |
| typography_set    | TEXT      | Typography Set (compact, airy) |
| container_width   | TEXT      | Standard, Full Width, Limited |
| background_config | JSONB     | Background-Einstellungen fÃ¼r Full Width |
| is_active         | BOOLEAN   | VerÃ¶ffentlicht? |
| tracking_pixel_id | TEXT      | z. B. Meta Pixel oder GTM-ID |
| campaign_id       | UUID      | VerknÃ¼pfung zu campaign.id |
| form_enabled      | BOOLEAN   | Lead-Formular aktiv? |
| form_target_table | TEXT      | Ziel-Datenbanktabelle (z. B. "leads") |
| redirect_url      | TEXT      | Ziel-URL nach erfolgreichem Submit |
| created_at        | TIMESTAMP | Erstellt am |
| updated_at        | TIMESTAMP | GeÃ¤ndert am |

---

### **2. landingpage_block (SeitenblÃ¶cke)**

| Feld             | Typ     | Beschreibung |
|---|---|-----|
| id               | UUID    | Block-ID |
| landingpage_id   | UUID    | Referenz auf landingpage.id |
| block_type       | ENUM    | Siehe Block-Typen unten |
| position         | INTEGER | Position innerhalb der Seite |
| content_json     | JSONB   | Block-spezifische Inhalte und Einstellungen |
| file_asset_id    | UUID    | (optional) Bild/Grafik Ã¼ber Dateimanager |
| carousel_config  | JSONB   | (optional) Carousel-Einstellungen |
| popup_config     | JSONB   | (optional) Popup-Formular Konfiguration |
| created_at       | TIMESTAMP | Erstellt am |

---

### **3. testimonials (Testimonial-Verwaltung)**

| Feld              | Typ       | Beschreibung |
|----|-----|-----|
| id                | UUID      | PrimÃ¤rschlÃ¼ssel |
| name              | TEXT      | Legacy-Feld (fÃ¼r Migration) |
| firstname         | TEXT      | Vorname des Kunden |
| lastname          | TEXT      | Nachname des Kunden |
| gender            | ENUM      | 'MÃ¤nnlich', 'Weiblich', 'Divers' |
| age               | INTEGER   | Alter des Kunden |
| location          | TEXT      | Wohnort |
| rating            | INTEGER   | Bewertung 1-5 Sterne |
| text_content      | TEXT      | Testimonial-Text (Pflichtfeld) |
| file_asset_id     | UUID      | VerknÃ¼pfung zu file_asset (Portrait) |
| tags              | TEXT[]    | Freie Tags (z.B. "erfolgreich", "motivation") |
| training_goals    | TEXT[]    | Trainingsziele (z.B. "Abnehmen", "Muskelaufbau") |
| member_since      | DATE      | Mitglied seit (optional) |
| is_active         | BOOLEAN   | Testimonial aktiv/inaktiv |
| created_at        | TIMESTAMP | Erstellt am |
| updated_at        | TIMESTAMP | Aktualisiert am |

### Bild-Versionierung System

**Integration mit file_asset:**
- **Kategorie**: `image`
- **Typ**: `portrait`
- **Arbeitsbereich**: `Verwaltung`
- **Modulreferenz**: `landingpage`
- **Tags**: `['testimonials', 'portrait', 'mitglieder']`
- **Ordnerstruktur**: `Landingpages > Bild > Portrait > Testimonials`

**Versionierungs-Features:**
- Automatische Versionierung bei Bild-Updates
- Neue Versionen werden automatisch als aktuelle Version gesetzt
- Detaillierte Beschreibungen basierend auf Testimonial-Daten
- Kaskadierende LÃ¶schung (Testimonial lÃ¶schen â†’ verknÃ¼pftes Bild lÃ¶schen)

**Beschreibungs-Template:**
```
Testimonial-Portrait: [Vorname Nachname] | ([Alter] Jahre, [Geschlecht], [Ort]) | [X]/5 Sterne | Mitglied seit [Monat Jahr] | Ziele: [Ziel1, Ziel2, Ziel3...] | Tags: [Tag1, Tag2, Tag3...] | Upload: [Methode] am [Datum]
```

### UI/UX Features (VollstÃ¤ndig implementiert)

**Ãœbersichtsseite:**
- **Statistik-Cards**: Gesamt, Aktive, Durchschnittsbewertung
- **Erweiterte Filter**:
  - Textsuche (Name, Ort, Tags, Trainingsziele)
  - Geschlechter-Filter
  - Rating-Filter (1+ bis 5 Sterne)
  - Tag-Filter
- **Grid-Layout**: Responsive Darstellung mit Avatar, Details, Status
- **Sortierung**: Erstellungsdatum absteigend

**Erstellungs-/Bearbeitungsformular:**
- **PersÃ¶nliche Daten**: Vor-/Nachname, Geschlecht, Alter, Ort
- **Bewertungssystem**: Interaktive 5-Sterne-Bewertung
- **Testimonial-Text**: Mehrzeiliges Textfeld (Pflicht)
- **Bild-Upload**: Drag&Drop oder Dateiauswahl (max 5MB)
- **Tags-System**: Dynamisches HinzufÃ¼gen/Entfernen von Tags
- **Trainingsziele**: Separate Ziel-Tags mit anderer Farbe
- **Mitgliedschaft**: "Mitglied seit" Datumsfeld
- **Status-Toggle**: Aktiv/Inaktiv

**Validierungen:**
- Vorname ist Pflichtfeld
- Rating zwischen 1-5
- Bildformate: alle gÃ¤ngigen Formate
- DateigrÃ¶ÃŸe: max 5MB

### Debug- und Test-Tools

**Implementierte Debug-Funktionen:**
- **ğŸ› Debug-Button**: Analysiert Testimonials-Struktur und file_asset Verbindungen
- **ğŸ”„ Test Versionierung-Button**: PrÃ¼ft Versionierungs-Infrastruktur
- **Konsolen-Logs**: Detaillierte Ausgaben fÃ¼r Upload- und Versionierungs-Prozesse

**Status-Checks:**
- PrÃ¼fung der `file_versions` Tabelle
- Validierung der `get_next_version_number` Funktion
- API-Funktions-Import-Tests

### Datenbank-Setup AbhÃ¤ngigkeiten

**Erforderliche SQL-Skripte:**
1. `testimonials_fix_final.sql` - Erweiterte Testimonials-Struktur
2. `file_versions_setup_clean.sql` - Versionierungs-System
3. `supabase_update_testimonials.sql` - VollstÃ¤ndige Integration

**Neue Datenbank-Objekte:**
- `gender_type` ENUM
- Erweiterte `testimonials` Spalten
- `file_versions` Tabelle mit RLS-Policies
- `get_next_version_number()` PostgreSQL-Funktion

### API-Integration

**File-Asset API-Funktionen:**
- `uploadNewVersion()` - Erstellt neue Bild-Versionen
- `setCurrentVersion()` - Aktiviert neue Version automatisch
- `getFileVersions()` - LÃ¤dt alle Versionen
- `deleteFileVersion()` - LÃ¶scht Versionen (nicht aktuelle)

**Upload-Workflow:**
1. **Neues Testimonial**: Erstellt neues `file_asset`
2. **Bearbeitung mit neuem Bild**: Versionierung aktiviert
3. **Automatische Aktivierung**: Neue Version wird sofort aktiv
4. **UI-Update**: Testimonials werden neu geladen

### Performance-Optimierungen

**Datenbank-Indizes:**
```sql
CREATE INDEX IF NOT EXISTS idx_testimonials_file_asset_id ON public.testimonials(file_asset_id);
CREATE INDEX IF NOT EXISTS idx_testimonials_firstname ON public.testimonials(firstname);
CREATE INDEX IF NOT EXISTS idx_testimonials_lastname ON public.testimonials(lastname);
CREATE INDEX IF NOT EXISTS idx_testimonials_training_goals ON public.testimonials USING GIN(training_goals);
```

**Optimierte Abfragen:**
- JOIN mit `file_asset` fÃ¼r Bild-Laden
- Array-basierte Tag- und Ziel-Suche
- Effiziente Filter-Kombinationen

---

### **4. form_templates (Formular-Builder)**

| Feld               | Typ       | Beschreibung |
|---|-----|-----|
| id                 | UUID      | PrimÃ¤rschlÃ¼ssel |
| name               | TEXT      | Template-Name |
| description        | TEXT      | Beschreibung des Formulars |
| fields_config      | JSONB     | Feld-Konfiguration (Name, Typ, Validierung) |
| target_table       | TEXT      | Ziel-Datenbanktabelle (z. B. "leads") |
| redirect_url       | TEXT      | Ziel-URL nach erfolgreichem Submit |
| success_message    | TEXT      | Erfolgsnachricht |
| requires_consent   | BOOLEAN   | DSGVO-Consent erforderlich |
| is_active          | BOOLEAN   | Aktiv/Inaktiv |
| created_at         | TIMESTAMP | Erstellt am |
| updated_at         | TIMESTAMP | GeÃ¤ndert am |

---

### **5. page_templates (Landingpage-Vorlagen)**

| Feld             | Typ       | Beschreibung |
|---|-----|-----|
| id               | UUID      | PrimÃ¤rschlÃ¼ssel |
| name             | TEXT      | Template-Name |
| description      | TEXT      | Beschreibung der Vorlage |
| category         | TEXT      | Kategorie (z. B. "Fitness", "Wellness") |
| tags             | TEXT[]    | Tags fÃ¼r Kategorisierung |
| campaign_type    | TEXT      | Kampagnen-Typ (optional) |
| blocks_config    | JSONB     | Vordefinierte Block-Struktur |
| preview_image_id | UUID      | (optional) FK â†’ file_asset.id |
| is_system        | BOOLEAN   | System-Template oder User-erstellt |
| usage_count      | INTEGER   | Wie oft verwendet |
| created_by       | UUID      | (optional) Ersteller |
| created_at       | TIMESTAMP | Erstellt am |
| updated_at       | TIMESTAMP | GeÃ¤ndert am |

---

### **6. ci_templates (CI-Design-Vorlagen)**

| Feld               | Typ       | Beschreibung |
|---|-----|-----|
| id                 | UUID      | PrimÃ¤rschlÃ¼ssel |
| name               | TEXT      | CI-Template-Name |
| description        | TEXT      | Beschreibung |
| primary_color      | TEXT      | Hauptfarbe (Hex) |
| secondary_color    | TEXT      | SekundÃ¤rfarbe (Hex) |
| accent_color       | TEXT      | Akzentfarbe (Hex) |
| background_color   | TEXT      | Hintergrundfarbe (Hex) |
| text_color         | TEXT      | Textfarbe (Hex) |
| font_family        | TEXT      | Haupt-Schriftart |
| font_headline      | TEXT      | Ãœberschriften-Schrift |
| font_sizes         | JSONB     | Font-GrÃ¶ÃŸen-Hierarchie |
| button_style       | JSONB     | Button-Styling (Radius, Padding, etc.) |
| logo_primary_id    | UUID      | (optional) FK â†’ file_asset.id |
| logo_secondary_id  | UUID      | (optional) FK â†’ file_asset.id |
| is_default         | BOOLEAN   | Standard-CI |
| created_at         | TIMESTAMP | Erstellt am |
| updated_at         | TIMESTAMP | GeÃ¤ndert am |

---

### **7. landing_settings (Rechtliches & Tracking)**

| Feld                    | Typ       | Beschreibung |
|---|-----|-----|
| id                      | UUID      | PrimÃ¤rschlÃ¼ssel |
| setting_key             | TEXT      | UNIQUE - EinstellungsschlÃ¼ssel |
| setting_value           | TEXT      | Einstellungswert |
| setting_type            | ENUM      | 'legal', 'tracking', 'cookie', 'general' |
| description             | TEXT      | Beschreibung der Einstellung |
| is_active               | BOOLEAN   | Aktiv/Inaktiv |
| updated_at              | TIMESTAMP | Letzte Ã„nderung |

**Vordefinierte Settings:**
- `impressum_text` (legal)
- `privacy_policy_text` (legal)
- `cookie_banner_text` (cookie)
- `meta_pixel_id` (tracking)
- `gtm_id` (tracking)
- `google_analytics_id` (tracking)
- `cancel_membership_url` (legal)

---

## ğŸ§© **Block-Typen Erweitert**

### ENUMs fÃ¼r block_type:
```typescript
'text'        // Rich Text Editor
'image'       // Bilder aus Dateimanager
'form'        // Formulare aus Templates
'button'      // CTAs mit Links
'testimonial' // Testimonials aus Verwaltung
'video'       // Eingebettete Videos
'headline'    // Ãœberschriften
'spacer'      // AbstÃ¤nde
'hero'        // Hero-Section mit Bild + Text
'gallery'     // Bildergalerie
'pricing'     // Preistabellen
'contact'     // Kontakt-Informationen
'faq'         // FAQ-Abschnitt
'services'    // Dienstleistungen
'timer'       // Timer/Countdown
'schedule'    // Kursplan
```

---

## ğŸ“ **Dateistruktur**

```
app/(protected)/landingpages/
â”œâ”€â”€ page.tsx                     # Ãœbersichtsseite aller Landingpages
â”œâ”€â”€ create/page.tsx              # Neue Landingpage erstellen
â”œâ”€â”€ [id]/
â”‚   â”œâ”€â”€ page.tsx                # Landingpage-Details bearbeiten
â”‚   â”œâ”€â”€ builder/page.tsx        # Page Builder Interface
â”‚   â””â”€â”€ preview/page.tsx        # Live-Vorschau
â”œâ”€â”€ testimonials/
â”‚   â”œâ”€â”€ page.tsx                # Testimonial-Ãœbersicht
â”‚   â”œâ”€â”€ create/page.tsx         # Neues Testimonial
â”‚   â””â”€â”€ [id]/edit/page.tsx      # Testimonial bearbeiten
â”œâ”€â”€ forms/
â”‚   â”œâ”€â”€ page.tsx                # Formular-Templates Ãœbersicht
â”‚   â”œâ”€â”€ create/page.tsx         # Neues Formular-Template
â”‚   â””â”€â”€ [id]/edit/page.tsx      # Template bearbeiten
â”œâ”€â”€ templates/
â”‚   â”œâ”€â”€ page.tsx                # Page-Templates Ãœbersicht
â”‚   â”œâ”€â”€ create/page.tsx         # Neues Template
â”‚   â””â”€â”€ [id]/edit/page.tsx      # Template bearbeiten
â”œâ”€â”€ branding/
â”‚   â”œâ”€â”€ page.tsx                # CI-Templates Ãœbersicht
â”‚   â”œâ”€â”€ create/page.tsx         # Neues CI-Template
â”‚   â””â”€â”€ [id]/edit/page.tsx      # CI bearbeiten
â”œâ”€â”€ settings/
â”‚   â””â”€â”€ page.tsx                # Rechtliches & Tracking
â””â”€â”€ components/
    â”œâ”€â”€ LandingpageList.tsx     # HauptÃ¼bersicht
    â”œâ”€â”€ LandingpageForm.tsx     # Basis-Formular
    â”œâ”€â”€ PageBuilder/
    â”‚   â”œâ”€â”€ Builder.tsx         # Drag & Drop Builder
    â”‚   â”œâ”€â”€ BlockLibrary.tsx    # Block-Auswahl
    â”‚   â”œâ”€â”€ BlockEditor.tsx     # Block-Konfiguration
    â”‚   â””â”€â”€ blocks/             # Block-Komponenten
    â”‚       â”œâ”€â”€ TextBlock.tsx
    â”‚       â”œâ”€â”€ ImageBlock.tsx
    â”‚       â”œâ”€â”€ FormBlock.tsx
    â”‚       â”œâ”€â”€ TestimonialBlock.tsx
    â”‚       â””â”€â”€ ...
    â”œâ”€â”€ Testimonials/
    â”‚   â”œâ”€â”€ TestimonialList.tsx
    â”‚   â”œâ”€â”€ TestimonialForm.tsx
    â”‚   â””â”€â”€ TestimonialCard.tsx
    â”œâ”€â”€ Forms/
    â”‚   â”œâ”€â”€ FormTemplateList.tsx
    â”‚   â”œâ”€â”€ FormBuilder.tsx
    â”‚   â””â”€â”€ FieldConfig.tsx
    â”œâ”€â”€ Templates/
    â”‚   â”œâ”€â”€ TemplateLibrary.tsx
    â”‚   â”œâ”€â”€ TemplateCard.tsx
    â”‚   â””â”€â”€ TemplatePreview.tsx
    â”œâ”€â”€ Branding/
    â”‚   â”œâ”€â”€ CITemplateList.tsx
    â”‚   â”œâ”€â”€ CIEditor.tsx
    â”‚   â”œâ”€â”€ ColorPicker.tsx
    â”‚   â””â”€â”€ FontSelector.tsx
    â”œâ”€â”€ Settings/
    â”‚   â”œâ”€â”€ LegalSettings.tsx
    â”‚   â”œâ”€â”€ TrackingSettings.tsx
    â”‚   â””â”€â”€ CookieSettings.tsx
    â””â”€â”€ Preview/
        â””â”€â”€ LandingpagePreview.tsx
```

---

## ğŸ¯ **UI/UX Flows**

### **1. Testimonial-Verwaltung**
1. **Ãœbersicht**: Liste aller Testimonials mit Filter (Kampagne, Rating, Tags)
2. **Erstellen**: Upload Bild, Name, Alter, Standort, Rating, Text eingeben
3. **Kategorisierung**: Tags vergeben, Kampagne zuordnen
4. **Verwendung**: Im Page Builder auswÃ¤hlbar Ã¼ber Dropdown

### **2. Formular-Builder**
1. **Template erstellen**: Name, Beschreibung
2. **Felder definieren**: Drag & Drop Feld-Editor
3. **Validierung**: Pflichtfelder, Datentypen, Regex-Pattern
4. **Ziel konfigurieren**: Tabelle, Redirect-URL, Erfolgsnachricht
5. **DSGVO**: Consent-Checkbox, Datenschutz-Link

### **3. Page-Templates**
1. **Bibliothek**: System-Templates + User-Templates
2. **Kategorien**: Fitness, Wellness, Angebote, etc.
3. **Tags**: Flexible Verschlagwortung
4. **Vorschau**: Live-Preview vor Verwendung
5. **Klonen**: Template als Basis fÃ¼r neue Landingpage

### **4. CI-Design-Vorlagen**
1. **Farb-Editor**: Primary, Secondary, Accent, Background, Text
2. **Schrift-Auswahl**: Haupt-Font, Ãœberschriften-Font, GrÃ¶ÃŸen-Hierarchie
3. **Button-Styling**: Border-Radius, Padding, Hover-Effekte
4. **Logo-Verwaltung**: Primary + Secondary Logo aus Dateimanager
5. **Live-Vorschau**: Komponenten-Beispiele mit gewÃ¤hltem CI

### **5. Rechtliches & Tracking**
1. **Legal Texte**: Impressum, Datenschutz, AGB editierbar
2. **Cookie-Banner**: Text, Design, Kategorien konfigurieren
3. **Tracking-Codes**: Meta Pixel, GTM, Google Analytics zentral verwalten
4. **Links**: "Jetzt kÃ¼ndigen" URL, Support-Kontakt

---

## ğŸ”— **VerknÃ¼pfungen zwischen Modulen**

### **Mit Kampagnen-Modul:**
- Landingpages werden Kampagnen zugeordnet
- Testimonials kÃ¶nnen kampagnenspezifisch sein
- Templates kÃ¶nnen nach Kampagnen-Typ gefiltert werden

### **Mit Dateimanager:**
- Bilder fÃ¼r Testimonials
- Hero-Bilder, Icons, Logos fÃ¼r Landingpages
- CI-Logos und Assets
- Template-Vorschaubilder

### **Mit Leads-Modul:**
- Formulare speichern direkt in leads-Tabelle
- Kampagnen-Attribution fÃ¼r Lead-Tracking
- Conversion-Tracking

---

## âš¡ **Erweiterte Features**

### **DSGVO-Compliance:**
- Cookie-Banner mit Kategorien
- Opt-in/Opt-out Tracking
- Datenschutz-Links in Formularen
- IP-Anonymisierung

### **SEO-Optimierung:**
- Meta-Tags pro Landingpage
- Open Graph Integration
- JSON-LD Schema Markup
- Performance-Optimierung

### **Analytics Integration:**
- Conversion-Tracking
- Heatmap-Integration
- A/B-Testing Framework
- Form-Analytics

---

## ğŸ›¡ï¸ **Validierungslogik**

### **Landingpage:**
- slug muss eindeutig sein
- Mindestens ein Block erforderlich
- CI-Template muss existieren

### **Testimonials:**
- Rating zwischen 1-5
- Text darf nicht leer sein
- Bild optional aber empfohlen

### **Formulare:**
- Mindestens ein Feld erforderlich
- Ziel-Tabelle muss existieren
- Pflichtfeld-Validierung

### **CI-Templates:**
- Farben mÃ¼ssen gÃ¼ltige Hex-Werte sein
- Font-Familie muss verfÃ¼gbar sein
- Mindestens Primary Color erforderlich

---

## ğŸ“Š **Performance & Skalierung**

### **Caching-Strategie:**
- Template-Bibliothek statisch gecacht
- CI-Vorlagen im localStorage
- Landingpage-BlÃ¶cke lazy geladen

### **Optimierungen:**
- Bild-Komprimierung automatisch
- CSS-Minification fÃ¼r CI-Styles
- JSON-Kompression fÃ¼r Block-Configs

---

## ğŸ”® **ZukÃ¼nftige Erweiterungen**

### **Geplante Features:**
- **Multi-Language Support**: Mehrsprachige Landingpages
- **A/B Testing**: Split-Tests fÃ¼r Conversion-Optimierung
- **Animation Builder**: CSS-Animationen fÃ¼r BlÃ¶cke
- **Mobile-First Templates**: Responsive Design Templates
- **API Integration**: Externe Service-Anbindungen
- **White-Label**: Komplett anpassbares Branding
