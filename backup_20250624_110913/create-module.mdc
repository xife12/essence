---
description:
globs:
alwaysApply: false
---
# Modul: Kursplan

## Zweck
Das Kursplan-Modul dient der zentralen Verwaltung und Darstellung von wiederkehrenden und temporÃ¤ren Kursen, inklusive Kurszeiten, KursrÃ¤umen, Kategorien und Standortzuordnung. Kurse kÃ¶nnen auf Landingpages angezeigt und dort individuell gefiltert dargestellt werden.

---

## ğŸ—„ï¸ Datenbankstruktur

### Tabelle: `public.course_categories`
| Feld        | Typ      | Beschreibung                    |
|-------------|----------|---------------------------------|
| id          | UUID     | PrimÃ¤rschlÃ¼ssel                 |
| name        | TEXT     | Kategoriename (z.B. "Yoga")     |
| description | TEXT     | Optional: Beschreibung          |
| icon        | TEXT     | Icon oder Emoji                 |
| color       | TEXT     | Hex-Farbe fÃ¼r UI-Darstellung    |
| sort_order  | INTEGER  | Reihenfolge                     |
| is_visible  | BOOLEAN  | Sichtbarkeit                    |
| created_at  | TIMESTAMP| Erstellt                        |
| updated_at  | TIMESTAMP| Aktualisiert                    |

### Tabelle: `public.course_rooms`
| Feld              | Typ      | Beschreibung                    |
|-------------------|----------|---------------------------------|
| id                | UUID     | PrimÃ¤rschlÃ¼ssel                 |
| name              | TEXT     | Raumname (z.B. "Studio 1")     |
| location          | TEXT     | Standort/Kursplan-Zuordnung     |
| max_capacity      | INTEGER  | Maximale KapazitÃ¤t              |
| description       | TEXT     | Optional: Beschreibung          |
| is_active         | BOOLEAN  | Aktiv/Inaktiv                   |
| category_ids      | UUID[]   | Zugewiesene Kategorien          |
| created_at        | TIMESTAMP| Erstellt                        |
| updated_at        | TIMESTAMP| Aktualisiert                    |

### Tabelle: `public.courses`
| Feld              | Typ      | Beschreibung                    |
|-------------------|----------|---------------------------------|
| id                | UUID     | PrimÃ¤rschlÃ¼ssel                 |
| name              | TEXT     | Kursname                        |
| description       | TEXT     | Kursbeschreibung                |
| category_id       | UUID     | FK â†’ course_categories.id       |
| trainer_id        | UUID     | FK â†’ staff.id                   |
| room_id           | UUID     | FK â†’ course_rooms.id            |
| max_participants  | INTEGER  | Max. Teilnehmerzahl             |
| current_participants | INTEGER | Aktuelle Teilnehmerzahl      |
| schedule_plan     | TEXT     | Kursplan-Zuordnung              |
| is_public         | BOOLEAN  | Ã–ffentlich anzeigen             |
| is_special        | BOOLEAN  | TemporÃ¤rer Kurs (Kursspezial)   |
| created_at        | TIMESTAMP| Erstellt                        |
| updated_at        | TIMESTAMP| Aktualisiert                    |

### Tabelle: `public.course_schedules`
| Feld        | Typ      | Beschreibung                         |
|-------------|----------|--------------------------------------|
| id          | UUID     | PrimÃ¤rschlÃ¼ssel                      |
| course_id   | UUID     | FK â†’ courses.id                      |
| day_of_week | INTEGER  | Wochentag (0=Sonntag, 1=Montag, ...) |
| start_time  | TIME     | Startzeit                            |
| end_time    | TIME     | Endzeit                              |
| special_date| DATE     | FÃ¼r Kursspezial: spezifisches Datum  |
| is_active   | BOOLEAN  | Aktiv/Inaktiv                        |
| created_at  | TIMESTAMP| Erstellt                             |

---

## ğŸ¯ UI-Struktur & Navigation

### Hauptnavigation (app/(protected)/kursplan/)
```
kursplan/
â”œâ”€â”€ page.tsx                 # ğŸ“… KursÃ¼bersicht (Wochenansicht)
â”œâ”€â”€ neu/
â”‚   â””â”€â”€ page.tsx            # â• Neuer Kurs (bereits UI vorhanden!)
â”œâ”€â”€ kategorien/
â”‚   â””â”€â”€ page.tsx            # ğŸ—‚ Kurskategorien verwalten
â”œâ”€â”€ raeume/
â”‚   â””â”€â”€ page.tsx            # ğŸ  KursrÃ¤ume verwalten
â”œâ”€â”€ einstellungen/
â”‚   â””â”€â”€ page.tsx            # âš™ï¸ Kursplan-Einstellungen
â””â”€â”€ [id]/
    â”œâ”€â”€ page.tsx            # Kurs-Details
    â””â”€â”€ bearbeiten/
        â””â”€â”€ page.tsx        # Kurs bearbeiten
```

### Komponenten-Struktur
```
app/components/kursplan/
â”œâ”€â”€ KursplanWeekView.tsx     # WochenÃ¼bersicht mit Zeitraster
â”œâ”€â”€ KursCard.tsx             # Einzelne Kurskarte
â”œâ”€â”€ KursFormModal.tsx        # Kurs erstellen/bearbeiten
â”œâ”€â”€ CategoryManager.tsx      # Kategorien-Verwaltung
â”œâ”€â”€ RoomManager.tsx          # RÃ¤ume-Verwaltung
â”œâ”€â”€ KursFilter.tsx           # Filter-Komponente
â””â”€â”€ ScheduleMatrix.tsx       # Wochentag-Zeit-Matrix
```

---

## ğŸ¨ KursÃ¼bersicht (Wochenplan)

### Darstellung
- **Spalten:** Montagâ€“Sonntag
- **Zeilen:** Uhrzeit-Raster (06:00â€“22:00, 30-Min-Schritte)
- **Kurskarten enthalten:**
  - Kursname
  - Kurskategorie (mit Icon/Farbe)
  - Raumname
  - Max. Teilnehmerzahl
  - Auslastungsbalken (z.B. 70% belegt)

### Filter & Steuerung
- **Filteroptionen:**
  - Kategorie (Dropdown)
  - Raum (Dropdown)
  - Trainer (Dropdown)
  - Standort/Kursplan-Zuordnung (Dropdown)
- **Steuerung:**
  - Wochenumschaltung (ZurÃ¼ck/Weiter)
  - "Nur Ã¶ffentliche Kurse" (Toggle)
  - "Kursspezials anzeigen" (Toggle)

---

## ğŸ“ Kurs anlegen/bearbeiten (bereits UI vorhanden!)

### Bestehende UI-Felder (entspricht Spezifikation):
- âœ… **Kursname** (Textfeld)
- âœ… **Beschreibung** (Freitext)
- âœ… **Kategorie** (Dropdown)
- âœ… **Trainer** (Dropdown aus Mitarbeitermodul)
- âœ… **Raum/Ort** (Dropdown)
- âœ… **Max. Teilnehmer** (Zahlenfeld)
- âœ… **Aktuelle Anzahl** (Zahlenfeld)
- âœ… **Ã–ffentlich anzeigen** (Toggle)
- âœ… **Kursspezial** (Checkbox â†’ Datumsauswahl)
- âœ… **Wochenmatrix** (Montag-Sonntag mit Uhrzeiten)

### Backend-Integration erforderlich:
- API-Anbindung fÃ¼r Speichern/Laden
- Validierung der Uhrzeiten
- Ãœberschneidungs-PrÃ¼fung bei RÃ¤umen/Trainern

---

## ğŸ—‚ Kurskategorien-Verwaltung

### UI-Komponenten:
- **Ãœbersichtstabelle:** Name, Icon, Farbe, Sichtbarkeit, Reihenfolge
- **Modal "Neue Kategorie":**
  - Name (Pflichtfeld)
  - Beschreibung (optional)
  - Icon-Picker (Emoji/Lucide Icons)
  - Farb-Picker (Hex-Werte)
  - Sichtbarkeit (Toggle)
- **Drag & Drop:** Reihenfolge Ã¤ndern
- **Aktionen:** Bearbeiten, LÃ¶schen (mit AbhÃ¤ngigkeits-Check)

---

## ğŸ  KursrÃ¤ume-Verwaltung

### UI-Komponenten:
- **Ãœbersichtstabelle:** Name, Standort, KapazitÃ¤t, Kategorien, Status
- **Modal "Neuer Raum":**
  - Raumname (Pflichtfeld)
  - Standort/Kursplan-Zuordnung (Dropdown)
  - Max. KapazitÃ¤t (Zahlenfeld)
  - Beschreibung (optional)
  - Kategorie-Zuweisungen (Multi-Select)
  - Aktiv-Status (Toggle)
- **Aktionen:** Bearbeiten, Deaktivieren

---

## ğŸ”— API-Struktur

### API-Dateien:
```typescript
lib/api/
â”œâ”€â”€ courses.ts              # CRUD fÃ¼r Kurse
â”œâ”€â”€ courseCategories.ts     # Kategorien-API
â”œâ”€â”€ courseRooms.ts          # RÃ¤ume-API
â””â”€â”€ courseSchedules.ts      # Zeitplan-API
```

### API-Methoden:
```typescript
// courses.ts
export const CoursesAPI = {
  getAll: () => Promise<Course[]>
  getById: (id: string) => Promise<Course>
  getWeekSchedule: (date: Date) => Promise<WeekSchedule>
  create: (data: CreateCourseData) => Promise<Course>
  update: (id: string, data: UpdateCourseData) => Promise<Course>
  delete: (id: string) => Promise<void>
  checkConflicts: (scheduleData: ScheduleData) => Promise<Conflict[]>
}
```

---

## ğŸ¯ Landingpage-Integration

### Kursplan-Block (bereits implementiert):
- **Canvas-Renderer:** Zeigt gefilterte Kurse an
- **Konfigurierbar nach:**
  - Anzahl Tage (1-7)
  - Kurskategorie (Filter)
  - Kursplan-Zuordnung (Standort)
  - Layout-Preset (Weekly Grid, Category Filter, etc.)

### Block-Presets:
- `weekly-grid` - VollstÃ¤ndige Wochenansicht
- `category-filter` - Nach Kategorien gefiltert
- `next-course` - NÃ¤chster Kurs hervorgehoben
- `compact-cards` - Kompakte Karten-Darstellung
- `tabbed-view` - Tabbed nach Kategorien

---

## ğŸ”’ Berechtigungen

| Rolle        | Berechtigung                              |
|--------------|-------------------------------------------|
| Admin        | Vollzugriff auf alle Kursplan-Funktionen |
| Studioleiter | Kurse anlegen/bearbeiten, Kategorien/RÃ¤ume verwalten |
| Mitarbeiter  | Nur eigene Kurse einsehen, keine Bearbeitung |

---

## âš¡ Besonderheiten & Validierungen

### Kurs-Logik:
- Ein Kurs kann **mehrfach pro Woche** stattfinden
- **ZeitÃ¼berschneidungen** werden validiert (Raum/Trainer)
- **Kursspezials** haben spezifische Daten statt Wochentage
- **Auslastung** wird live berechnet

### Validierungen:
- Startzeit < Endzeit
- Max. Teilnehmer > 0
- Keine Doppelbelegung von RÃ¤umen
- Trainer-VerfÃ¼gbarkeit prÃ¼fen
- Kursspezial-Daten in der Zukunft

### UX-Features:
- **Live-Updates** bei Ã„nderungen
- **Drag & Drop** fÃ¼r ZeitÃ¤nderungen
- **Konflikterkennung** mit VorschlÃ¤gen
- **Mobile-Responsive** Wochenansicht

---

## ğŸš€ Implementierungsreihenfolge

1. **Datenbank-Migration** ausfÃ¼hren
2. **API-Layer** implementieren  
3. **KursÃ¼bersicht (Wochenplan)** erstellen
4. **Bestehende UI** mit Backend verbinden
5. **Kategorien/RÃ¤ume-Verwaltung** implementieren
6. **Landingpage-Block** finalisieren
7. **Mobile-Optimierung** & Testing

---

## ğŸ“‹ Status: Bereit fÃ¼r Implementierung

- âœ… **UI-Design:** VollstÃ¤ndig spezifiziert
- âœ… **Datenbankschema:** Definiert  
- âœ… **API-Struktur:** Geplant
- âœ… **Komponenten-Architektur:** Strukturiert
- ğŸ”„ **Implementation:** Bereit zu starten

**GeschÃ¤tzte Entwicklungszeit:** 3-4 Wochen
**PrioritÃ¤t:** Hoch (Landingpage-Integration bereits aktiv)
